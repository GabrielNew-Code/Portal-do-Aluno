let token="c724a5a5c8f5f3e3d5a3b9f9b8a4f3d4",conversationId="669eb38a-e746-4ab0-a06e-e2146bd17bbb",wss,lastInteration,defineCustomKendoChatAgent=function(){window.customKendoChatAgent=new kendo.Class.extend({init:function(e){this.chat=e,this.userInfo={id:"botty",iconUrl:"https://unifenasprod.cronapp.io/img/avatar2.png",name:"Unifenas"},this.makeCursorOnFocus(),setInterval(()=>this.autoCloseWSSIdle(),1e3)},isIdle:function(){if(lastInteration){return((new
Date).getTime()-lastInteration.getTime())/1e3>60}return!1},autoCloseWSSIdle:function(){this.isIdle()&&wss&&(wss.close(),wss=void 0,console.log("WebSocket closed - Chat idle"))},startMessageSended:!1,sendStartMessage:function(){this.startMessageSended||(this.postMessage("a2e63ee01401aaeca78be023dfbb8c59"),this.startMessageSended=!0)},hasTextSelected:function(){let
e=window.getSelection().anchorNode;return!!e&&"[object Text]"==e},clearSelectedText:function(){window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges()},makeCursorOnFocusWebView:function(e){if(0==e.length)return!1;let
t=$("div.k-message-list-content").scrollTop(),s=t+$("div.k-message-list-content").height(),n=e.offset().top,o=n+e.height();return s>=n&&t
<=o},makeCursorOnFocus:function(){let e=this,t=$( 'input[class="k-input"]');setInterval(function(){let s=$(
    "div.k-card-list");!t.is( ":visible")||isMobileDevice()||e.hasTextSelected()||e.makeCursorOnFocusWebView(s)||t.focus()},500)},openSocket:function(e){(wss=new WebSocket( "wss://cronchatcronapp.cronapp.io/")).onopen=function(t){wss.send(JSON.stringify({type: "register",token:token,conversationId:conversationId})),e&&(this.postMessage(e),e=void
    0)}.bind(this),wss.onmessage=function(e){let t=JSON.parse(e.data);lastInteration=new Date,this.readContents(t)}.bind(this),wss.onclose=function(){this.isIdle()||this.openSocket()}.bind(this)},readContents:function(e){let t=this;e&&(e.forEach(e=>{e.text&&t.renderMessage(e.text),e.carousel&&t.chat.renderAttachments(e.carousel),e.quick_reply&&t.chat.renderSuggestedActions(e.quick_reply),(e.carousel||e.quick_reply)&&(t.keepButtonsQR(),t.generateLinkInButtonValue()),e.webview&&(t.chat.renderAttachments(e.webview),t.generateMessageWebView(e))}),this.removeEmptyMessageList())},removeEmptyMessageList:function(){$(".k-message-list.k-avatars
    .k-message-group ").each(function(){0==$(this).find(".k-message.k-only,.k-message.k-first,.k-message.k-last").length&&$(this).remove()})},generateLinkInButtonValue:function(){let e=this;$(".k-button.k-flat.k-primary,.k-quick-reply").each(function(){let
    t=$(this).data("value"),s=$(this).html();$(this).off("click"),$(this).on("click",function(n){e.selectButton(n),s.indexOf("üìÉ")>-1&&(t.toString().startsWith("http://")||t.toString().startsWith("https://"))?e.downloadFile(t,s):t&&(t.toString().startsWith("http://")||t.toString().startsWith("https://"))?window.open(t):e.postMessage(t.toString()),n.preventDefault(),n.stopPropagation()}.bind(this))})},downloadFile:function(e,t){let
    s=`https://cronchatcronapp.cronapp.io/download?urlDownload=${e}&fileName=${t=t.substr(3)}`;fetch(s).then(function(e){return e.blob()}).then(function(e){const s=document.createElement("a");s.style.display="none",document.body.appendChild(s),s.href=window.URL.createObjectURL(new
    Blob([e],{data:e.type})),s.setAttribute("download",t),s.click(),window.URL.revokeObjectURL(s.href),document.body.removeChild(s)})},keepButtonsQR:function(e){$(".k-quick-replies").addClass("k-quick-repliesx"),$(".k-quick-replies").removeClass("k-quick-replies")},selectButton:function(e){setTimeout(function(){let
    t=$(e.currentTarget).parent();t.hasClass("k-quick-repliesx")&&t.children().each((e,t)=>{$(t).off("click"),$(t).css("pointer-events","none")});let s="#17a2b8";s||"rgba(0, 0, 0, 0)"==(s=$(e.currentTarget).css("background-color"))&&(s="rgb(254,242,235)");let
    n=$(e.currentTarget).attr("style"),o="White";o||(o=$(e.currentTarget).css("color"));$(e.currentTarget).attr("style",`color: ${o} !important; background-color: ${s} !important; font-family: Arial !important; font-size: 14px !important; ${n}`)},100)},getCustomUser:function(){return{id:this.chat.getUser().id,iconUrl:this.userInfo.iconUrl,name:this.userInfo.name}},postMessage:async
    function(text=""){lastInteration=new Date,this.clearSelectedText();let type="conversation";try{if(wss){let typingIndicator=eval("true");typingIndicator&&this.chat.renderUserTypingIndicator(this.getCustomUser()),wss.send(JSON.stringify({type:type,token:token,conversationId:conversationId,text:text}))}else
    this.openSocket(text)}catch(e){e.message.indexOf("CONNECTING")>-1&&(console.log("try send again, websocket connecting"),setTimeout(function(){this.postMessage(text)}.bind(this),1e3))}},generateMessageGroupAfterQR:function(){if(!((e=$(".k-message-list-content").children().last()).hasClass("k-message-group
    ")||e.hasClass("k-message-group")||e.hasClass("k-card-deck-scrollwrap")||e.hasClass("k-no-avatar"))&&$('div[class="k-message-group "] img')[0]){let e=$('div[class="k-message-group "] p[class="k-author"]').html(),t=$('div[class="k-message-group "]
    img')[0].src;$(".k-message-list-content").append("
    <div "+this.userInfo.name.toLowerCase()+' class="k-message-group "><p class="k-author ">'+e+'</p><img src=" '+t+' " alt=" '+e+' " class="k-avatar
        "></div>')}var e},generateMessageWebView:function(e){$(".k-card-type-rich ").attr("style ","margin-left: 12%; width: 100%; "),$(".k-card-body ").last().append(`<iframe src="${e.webview.attachments[0].content.webviewhtml[0].url} " style="border-width: 0; " width="100% " height="300
        "></iframe>`)},renderMessage:function(e){let t=this,s=e.split("\n ");this.generateMessageGroupAfterQR(),s.forEach(e=>{t.chat.renderMessage({type:"text ",text:e,timestamp:t._timestamp},t.userInfo)}),setTimeout(function(){$(".k-message-group
        ").linkify()},100)},renderMessages:function(e){let t=this;$(e).each(function(e,s){t.renderMessage(s)})}});let defineLanguagePtBR=function(){window.kendo.chat.ChatView.prototype.options.messages.isTyping=" est√° escrevendo. ",window.kendo.chat.ChatView.prototype.options.messages.areTyping=" est√£o escrevendo. ",window.kendo.chat.ChatView.prototype.options.messages.and=" e ",window.kendo.ui.Chat.prototype.options.messages.placeholder="Digite uma mensagem...
        ",window.kendo.culture("pt-BR ")};defineLanguagePtBR();let customChat=$("#customChat_669eb38a-e746-4ab0-a06e-e2146bd17bbb ").kendoChat({post:function(e){customAgent.postMessage(e.text)},actionClick:function(e){}}).data("kendoChat
        ");window.customAgent=new customKendoChatAgent(customChat)},checkKendoAvaiable=setInterval(function(){window.kendo&&window.kendo.chat&&(defineCustomKendoChatAgent(),clearInterval(checkKendoAvaiable))},100);window.isMobileDevice=function(){return void 0!==window.orientation||-1!==navigator.userAgent.indexOf("IEMobile ")},window.enableViewForMobile=function(){if(isMobileDevice()){$("#avatarIntro_669eb38a-e746-4ab0-a06e-e2146bd17bbb ").hide();let e=$(".chatbot ");$("div ").each(function(){0==$(this).closest(e).length&&$(this).is(":visible
        ")&&($(this).hide(),$(this).data("cronchathidden ",!0))})}},window.disableViewForMobile=function(){isMobileDevice()&&($("#avatarIntro_669eb38a-e746-4ab0-a06e-e2146bd17bbb ").show(),$("div ").each(function(){$(this).data("cronchathidden ")&&($(this).show(),$(this).data("cronchathidden
        ",void 0))}))};